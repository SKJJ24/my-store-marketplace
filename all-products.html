<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>All Products - MyStoreZW</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='48' fill='%23000'/%3E%3Cpath d='M30 35 L50 25 L70 35 L70 65 L50 75 L30 65 Z' fill='white' opacity='0.9'/%3E%3C/svg%3E">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            padding-bottom: 70px;
        }

        .header {
            background: #000;
            color: white;
            position: sticky;
            top: 0;
            z-index: 999;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
flex-wrap: wrap;
            
        }
    .logo {
            font-size: 24px;
            font-weight: 900;
            cursor: pointer;
            letter-spacing: -1px;
            transition: opacity 0.3s;
        }
        .logo:hover {
            opacity: 0.8;
        }
        .search-container {
            flex: 1;
            max-width: 600px;
            position: relative;
        }
        .search-bar {
            display: flex;
            border: 2px solid #333;
            border-radius: 8px;
            overflow: hidden;
            background: white;
        }
        .search-bar input {
            flex: 1;
            padding: 12px 16px;
            border: none;
            font-size: 14px;
            outline: none;
        }
        .search-bar button {
            padding: 0 24px;
            background: #000;
            color: white;
            border: none;
            cursor: pointer;
            transition: background 0.3s;
        }
        .search-bar button:hover {
            background: #333;
        }
        .header-actions {
            display: flex;
            gap: 24px;
            align-items: center;
        }

        
        @media (max-width: 768px) {
            .account-dropdown {
                display: none;
            }
        }
        .cart-icon {
            position: relative;
            cursor: pointer;
            font-size: 24px;
        }
        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff4444;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
        }
        
        /* Account Dropdown Menu */
        .account-dropdown {
            position: relative;
            cursor: pointer;
        }
        .account-menu {
            position: absolute;
            top: calc(100% + 10px);
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            min-width: 280px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s;
            z-index: 1000;
        }
        .account-dropdown:hover .account-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        .account-menu-header {
            padding: 20px;
            border-bottom: 1px solid #e5e5e5;
        }
        .account-menu-user {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 4px;
        }
        .account-menu-email {
            font-size: 13px;
            color: #666;
        }
        .account-menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: #333;
            text-decoration: none;
            font-size: 14px;
            transition: background 0.3s;
            cursor: pointer;
        }
        .account-menu-item:hover {
            background: #f5f5f5;
        }
        .account-menu-item i {
            width: 20px;
            font-size: 16px;
            color: #666;
        }
        .account-menu-divider {
            height: 1px;
            background: #e5e5e5;
            margin: 8px 0;
        }
        .account-menu-logout {
            color: #ef4444;
        }
        .account-menu-logout:hover {
            background: #fee2e2;
        }
        .account-menu-logout i {
            color: #ef4444;
        }
        .account-menu-signin {
            background: #000;
            color: white;
            border-radius: 8px;
            margin: 12px 16px;
            justify-content: center;
            font-weight: 600;
        }
        .account-menu-signin:hover {
            background: #333;
        }

        /* Mobile Account Menu */
        .mobile-account-menu {
            position: fixed;
            bottom: -100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 24px 24px 0 0;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
            z-index: 2500;
            transition: bottom 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            max-height: 80vh;
            overflow-y: auto;
        }
        .mobile-account-menu.active {
            bottom: 0;
        }
        .mobile-menu-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2499;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .mobile-menu-overlay.active {
            display: block;
            opacity: 1;
        }
        .mobile-menu-handle {
            width: 40px;
            height: 4px;
            background: #ddd;
            border-radius: 2px;
            margin: 12px auto;
        }
        .mobile-menu-header {
            padding: 20px;
            border-bottom: 1px solid #e5e5e5;
        }
        .mobile-menu-user {
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 4px;
        }
        .mobile-menu-email {
            font-size: 14px;
            color: #666;
        }
        .mobile-menu-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px 20px;
            color: #333;
            text-decoration: none;
            font-size: 15px;
            transition: background 0.3s;
            cursor: pointer;
            border-bottom: 1px solid #f5f5f5;
        }
        .mobile-menu-item:active {
            background: #f5f5f5;
        }
        .mobile-menu-item i {
            width: 24px;
            font-size: 18px;
            color: #666;
        }
        .mobile-menu-logout {
            color: #ef4444;
        }
        .mobile-menu-logout i {
            color: #ef4444;
        }
        .mobile-menu-signin {
            background: #000;
            color: white;
            border-radius: 12px;
            margin: 16px 20px;
            padding: 16px;
            justify-content: center;
            font-weight: 600;
        }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            gap: 24px;
        }

        .filters-sidebar {
            width: 280px;
            flex-shrink: 0;
            background: white;
            border-radius: 12px;
            padding: 20px;
            height: fit-content;
            position: sticky;
            top: 90px;
        }
        .filters-sidebar h3 {
            font-size: 20px;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #000;
        }
        .filter-group {
            margin-bottom: 24px;
        }
        .filter-group h4 {
            font-size: 14px;
            margin-bottom: 12px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .filter-option {
            padding: 10px 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 14px;
        }
        .filter-option:hover {
            background: #f5f5f5;
        }
        .filter-option.active {
            background: #000;
            color: white;
        }
        .filter-label {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .filter-label i {
            font-size: 16px;
            width: 20px;
        }
        .filter-count {
            font-size: 12px;
            color: #999;
            background: #f5f5f5;
            padding: 2px 8px;
            border-radius: 12px;
        }
        .filter-option.active .filter-count {
            background: rgba(255,255,255,0.2);
            color: white;
        }
        .clear-filters {
            width: 100%;
            padding: 10px;
            background: #f5f5f5;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .clear-filters:hover {
            background: #e5e5e5;
        }

        .products-container {
            flex: 1;
        }
        .products-header {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }
        .products-title {
            font-size: 24px;
            font-weight: 700;
        }
        .products-count {
            color: #666;
            font-size: 14px;
        }
        .sort-select {
            padding: 10px 16px;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            outline: none;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        /* Skeleton Loading */
        .skeleton-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            animation: pulse 1.5s ease-in-out infinite;
        }
        .skeleton-image {
            width: 100%;
            height: 280px;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        .skeleton-info {
            padding: 20px;
        }
        .skeleton-line {
            height: 16px;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 4px;
            margin-bottom: 12px;
        }
        .skeleton-line.short {
            width: 60%;
        }
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .product-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 32px rgba(0,0,0,0.15);
        }
        .product-image {
            width: 100%;
            height: 280px;
            background: #fafafa;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }
        .product-card:hover .product-image img {
            transform: scale(1.05);
        }
        .product-discount {
            position: absolute;
            top: 12px;
            left: 12px;
            background: #ff4444;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 700;
        }
        .wishlist-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 40px;
            height: 40px;
            background: white;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .wishlist-btn:hover {
            transform: scale(1.1);
        }
        .wishlist-btn.active {
            color: #ff4444;
        }
        .product-info {
            padding: 20px;
        }
        .product-name {
            font-size: 15px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            min-height: 44px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .product-price {
            font-size: 24px;
            font-weight: 900;
            color: #000;
            margin-bottom: 8px;
        }
        .original-price {
            text-decoration: line-through;
            font-size: 16px;
            color: #999;
            margin-left: 8px;
            font-weight: 500;
        }
        .product-seller {
            font-size: 13px;
            color: #666;
            margin-bottom: 12px;
        }
        .btn {
            width: 100%;
            padding: 12px;
            border: 2px solid #000;
            background: white;
            color: #000;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .btn:hover {
            background: #000;
            color: white;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-top: 32px;
        }
        .pagination-btn {
            padding: 10px 16px;
            background: white;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        .pagination-btn:hover:not(:disabled) {
            background: #000;
            color: white;
            border-color: #000;
        }
        .pagination-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        .pagination-btn.active {
            background: #000;
            color: white;
            border-color: #000;
        }

        .error-message {
            background: white;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            grid-column: 1 / -1;
        }
        .error-message i {
            font-size: 48px;
            color: #ff4444;
            margin-bottom: 16px;
        }
        .error-message h3 {
            font-size: 20px;
            margin-bottom: 8px;
        }
        .error-message p {
            color: #666;
            margin-bottom: 20px;
        }
        .retry-btn {
            padding: 12px 24px;
            background: #000;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .no-products {
            text-align: center;
            padding: 60px 20px;
            color: #666;
            grid-column: 1 / -1;
            background: white;
            border-radius: 12px;
        }
        .no-products i {
            font-size: 60px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        /* Product Detail Modal - Fullscreen */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: white;
            z-index: 2000;
            overflow-y: auto;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .modal-overlay.active {
            display: block;
            opacity: 1;
        }
        .modal-header {
            position: sticky;
            top: 0;
            background: white;
            padding: 16px 20px;
            border-bottom: 1px solid #e5e5e5;
            display: flex;
            align-items: center;
            gap: 16px;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .modal-back-btn {
            width: 40px;
            height: 40px;
            background: #f5f5f5;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 20px;
        }
        .modal-back-btn:hover {
            background: #000;
            color: white;
            transform: translateX(-4px);
        }
        .modal-header h2 {
            font-size: 18px;
            flex: 1;
            margin: 0;
        }
        .modal-content {
            background: white;
            max-width: 1200px;
            margin: 0 auto;
        }
        .modal-body {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 60px;
            padding: 40px;
        }
        .modal-gallery {
            position: sticky;
            top: 100px;
            height: fit-content;
        }
        .main-image-container {
            width: 100%;
            height: 600px;
            background: #fafafa;
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 20px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .main-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 20px;
        }
        .image-zoom-icon {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 40px;
            height: 40px;
            background: white;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        .image-zoom-icon:hover {
            background: #000;
            color: white;
            transform: scale(1.1);
        }
        .thumbnail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 12px;
        }
        .thumbnail {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 12px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s;
            background: #fafafa;
            padding: 8px;
        }
        .thumbnail:hover {
            border-color: #ddd;
            transform: translateY(-2px);
        }
        .thumbnail.active {
            border-color: #000;
        }
        .modal-info {
            padding: 20px 0;
        }
        .modal-info h2 {
            font-size: 32px;
            margin-bottom: 16px;
            line-height: 1.3;
        }
        .modal-price-section {
            background: #f5f5f5;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 24px;
        }
        .modal-price {
            font-size: 36px;
            font-weight: 900;
            margin-bottom: 8px;
            color: #000;
        }
        .price-savings {
            color: #10b981;
            font-size: 14px;
            font-weight: 600;
        }
        .modal-tags {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }
        .modal-tag {
            background: #000;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }
        .modal-tag.discount {
            background: #ff4444;
        }
        .modal-tag.stock {
            background: #10b981;
        }
        .modal-description {
            color: #666;
            line-height: 1.8;
            margin-bottom: 32px;
            font-size: 15px;
        }
        .modal-meta {
            background: white;
            border: 2px solid #e5e5e5;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 32px;
        }
        .modal-meta-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e5e5e5;
        }
        .modal-meta-item:last-child {
            border-bottom: none;
        }
        .modal-meta-label {
            color: #666;
            font-size: 14px;
        }
        .modal-meta-value {
            font-weight: 600;
            font-size: 14px;
        }
        .modal-actions {
            display: flex;
            gap: 16px;
            position: sticky;
            bottom: 0;
            background: white;
            padding: 24px 0;
            border-top: 2px solid #e5e5e5;
        }
        .btn-large {
            flex: 1;
            padding: 18px;
            font-size: 16px;
            font-weight: 700;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn-add-cart {
            background: #000;
            color: white;
            border: none;
        }
        .btn-add-cart:hover {
            background: #333;
        }
        .btn-wishlist {
            background: white;
            color: #000;
            border: 2px solid #000;
        }
        .btn-wishlist:hover {
            background: #000;
            color: white;
        }
        .btn-wishlist.active {
            background: #ff4444;
            border-color: #ff4444;
            color: white;
        }

        /* Image Lightbox */
        .image-lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0,0,0,0.95);
            z-index: 3000;
            align-items: center;
            justify-content: center;
        }
        .image-lightbox.active {
            display: flex;
        }
        .lightbox-image {
            max-width: 90%;
            max-height: 90vh;
            object-fit: contain;
        }
        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
        }

        @media (max-width: 1024px) {
            .modal-body {
                grid-template-columns: 1fr;
                gap: 30px;
                padding: 20px;
            }
            .modal-gallery {
                position: static;
            }
            .main-image-container {
                height: 400px;
            }
        }

        @media (max-width: 768px) {
            .modal-body {
                padding: 10px;
            }
            .main-image-container {
                height: 300px;
            }
            .modal-info h2 {
                font-size: 24px;
            }
            .modal-price {
                font-size: 28px;
            }
            .modal-actions {
                flex-direction: column;
            }
        }

        /* Cart Sidebar */
        .cart-sidebar {
            position: fixed;
            right: -400px;
            top: 0;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: -4px 0 20px rgba(0,0,0,0.2);
            transition: right 0.3s ease;
            z-index: 3000;
            display: flex;
            flex-direction: column;
        }
        .cart-sidebar.active {
            right: 0;
        }
        .cart-header {
            padding: 20px;
            background: #000;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .close-cart {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }
        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        .cart-item {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e5e5e5;
        }
        .cart-item-image {
            width: 60px;
            height: 60px;
            background: #fafafa;
            border-radius: 6px;
            overflow: hidden;
        }
        .cart-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .cart-item-info {
            flex: 1;
        }
        .cart-item-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .cart-item-price {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        .cart-item-qty {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .qty-btn {
            width: 28px;
            height: 28px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        .qty-btn:hover {
            background: #000;
            color: white;
        }
        .cart-footer {
            padding: 20px;
            border-top: 2px solid #e5e5e5;
            background: #fafafa;
        }
        .cart-total {
            display: flex;
            justify-content: space-between;
            margin-bottom: 16px;
            font-size: 18px;
            font-weight: 700;
        }
        .checkout-btn {
            width: 100%;
            padding: 16px;
            background: #000;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
        }
        /* Wishlist Modal - AliExpress Style */
        #wishlistModal {
            background: #f5f5f5;
        }
        #wishlistModal .modal-content {
            max-width: 100%;
            height: 100vh;
            border-radius: 0;
            display: flex;
            flex-direction: column;
        }
        .wishlist-header {
            position: sticky;
            top: 0;
            background: white;
            padding: 16px 20px;
            border-bottom: 1px solid #e5e5e5;
            display: flex;
            align-items: center;
            gap: 16px;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .wishlist-back-btn {
            width: 40px;
            height: 40px;
            background: #f5f5f5;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 20px;
        }
        .wishlist-back-btn:hover {
            background: #000;
            color: white;
            transform: translateX(-4px);
        }
        .wishlist-title-section {
            flex: 1;
        }
        .wishlist-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        .wishlist-subtitle {
            font-size: 13px;
            color: #666;
        }
        .wishlist-actions-header {
            display: flex;
            gap: 8px;
        }
        .wishlist-header-btn {
            padding: 8px 16px;
            background: white;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .wishlist-header-btn:hover {
            border-color: #000;
            background: #000;
            color: white;
        }
        .wishlist-body {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }
        .wishlist-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
            max-width: 1400px;
            margin: 0 auto;
        }
        .wishlist-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }
        .wishlist-card:hover {
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            transform: translateY(-4px);
        }
        .wishlist-card-image {
            width: 100%;
            height: 280px;
            background: #fafafa;
            position: relative;
            overflow: hidden;
        }
        .wishlist-card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }
        .wishlist-card:hover .wishlist-card-image img {
            transform: scale(1.05);
        }
        .wishlist-remove-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 36px;
            height: 36px;
            background: rgba(255,255,255,0.95);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 10;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .wishlist-remove-btn:hover {
            background: #ff4444;
            color: white;
            transform: scale(1.1);
        }
        .wishlist-discount-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            background: #ff4444;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 700;
        }
        .wishlist-stock-badge {
            position: absolute;
            bottom: 12px;
            left: 12px;
            background: rgba(255,255,255,0.95);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .wishlist-stock-badge.in-stock {
            color: #10b981;
        }
        .wishlist-stock-badge.out-of-stock {
            color: #ff4444;
        }
        .wishlist-card-info {
            padding: 16px;
        }
        .wishlist-card-name {
            font-size: 14px;
            font-weight: 600;
            color: #000;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.4;
            min-height: 40px;
        }
        .wishlist-card-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            font-size: 12px;
            color: #666;
        }
        .wishlist-card-meta i {
            font-size: 11px;
        }
        .wishlist-card-pricing {
            display: flex;
            align-items: baseline;
            gap: 8px;
            margin-bottom: 12px;
        }
        .wishlist-card-price {
            font-size: 22px;
            font-weight: 900;
            color: #000;
        }
        .wishlist-card-original-price {
            font-size: 14px;
            color: #999;
            text-decoration: line-through;
        }
        .wishlist-card-actions {
            display: flex;
            gap: 8px;
        }
        .wishlist-add-cart-btn {
            flex: 1;
            padding: 10px;
            background: #000;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        .wishlist-add-cart-btn:hover {
            background: #333;
            transform: translateY(-2px);
        }
        .wishlist-add-cart-btn:active {
            transform: translateY(0);
        }
        .wishlist-view-btn {
            padding: 10px 16px;
            background: white;
            color: #000;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .wishlist-view-btn:hover {
            border-color: #000;
        }
        .wishlist-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 80px 20px;
            text-align: center;
            background: white;
            border-radius: 16px;
            margin: 40px auto;
            max-width: 500px;
        }
        .wishlist-empty-icon {
            width: 120px;
            height: 120px;
            background: #fff0f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 24px;
        }
        .wishlist-empty-icon i {
            font-size: 60px;
            color: #ff4444;
        }
        .wishlist-empty h3 {
            font-size: 24px;
            margin-bottom: 8px;
            color: #000;
        }
        .wishlist-empty p {
            color: #666;
            font-size: 16px;
            margin-bottom: 24px;
        }
        .wishlist-empty-btn {
            padding: 14px 32px;
            background: #000;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .wishlist-empty-btn:hover {
            background: #333;
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .wishlist-header {
                padding: 12px 16px;
            }
            .wishlist-title {
                font-size: 18px;
            }
            .wishlist-subtitle {
                font-size: 12px;
            }
            .wishlist-actions-header {
                display: none;
            }
            .wishlist-body {
                padding: 12px;
            }
            .wishlist-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            .wishlist-card-image {
                height: 200px;
            }
            .wishlist-card-info {
                padding: 12px;
            }
            .wishlist-card-name {
                font-size: 13px;
                min-height: 36px;
            }
            .wishlist-card-price {
                font-size: 18px;
            }
            .wishlist-card-actions {
                flex-direction: column;
            }
            .wishlist-view-btn {
                width: 100%;
            }
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 12px;
            pointer-events: none;
        }
        .toast {
            background: white;
            padding: 16px 20px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 320px;
            pointer-events: all;
            animation: toastSlideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        @keyframes toastSlideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        .toast.toast-out {
            animation: toastSlideOut 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        @keyframes toastSlideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }
        .toast-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }
        .toast.success .toast-icon {
            background: #d1fae5;
            color: #10b981;
        }
        .toast.error .toast-icon {
            background: #fee2e2;
            color: #ef4444;
        }
        .toast.info .toast-icon {
            background: #dbeafe;
            color: #3b82f6;
        }
        .toast.warning .toast-icon {
            background: #fef3c7;
            color: #f59e0b;
        }
        .toast-content {
            flex: 1;
        }
        .toast-title {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 14px;
        }
        .toast-message {
            font-size: 13px;
            color: #666;
        }
        .toast-close {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 18px;
            padding: 4px;
            transition: color 0.3s;
        }
        .toast-close:hover {
            color: #333;
        }

        @media (max-width: 768px) {
            .toast-container {
                top: 10px;
                right: 10px;
                left: 10px;
            }
            .toast {
                min-width: auto;
                width: 100%;
            }
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 -2px 12px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            z-index: 998;
        }
        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: #666;
            text-decoration: none;
            font-size: 10px;
            padding: 8px 16px;
            transition: color 0.3s;
            position: relative;
        }
        .bottom-nav-item.active {
            color: #000;
        }
        .bottom-nav-item i {
            font-size: 20px;
        }
        .bottom-nav-badge {
            position: absolute;
            top: 4px;
            right: 12px;
            background: #ff4444;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 10px;
            font-weight: bold;
        }

        .mobile-filter-btn {
            display: none;
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: #000;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            cursor: pointer;
            z-index: 900;
        }

        @media (max-width: 1024px) {
            .filters-sidebar {
                display: none;
            }
            .filters-sidebar.mobile-active {
                display: block;
                position: fixed;
                top: 0;
                left: 0;
                width: 300px;
                height: 100vh;
                z-index: 1000;
                overflow-y: auto;
            }
            .mobile-filter-btn {
                display: block;
            }
            .filter-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.7);
                z-index: 999;
            }
            .filter-overlay.active {
                display: block;
            }
            .modal-body {
                grid-template-columns: 1fr;
            }
            .cart-sidebar {
                width: 100%;
                right: -100%;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 10px;
            }
            .products-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            .product-image {
                height: 200px;
            }
            .product-info {
                padding: 12px;
            }
            .search-bar {
                width: 100%;
                order: 3;
            }
            .modal-body {
                padding: 20px;
            }
            .main-image {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="logo" onclick="window.location.href='index.html'">MyStoreZW</div>
            <div class="search-bar">
                <input type="text" placeholder="Search products..." id="searchInput">
                <button onclick="applySearch()"><i class="fas fa-search"></i></button>
            </div>
            <div class="header-actions">
                <div class="account-dropdown">
                    <i class="fas fa-user-circle" style="font-size: 28px; cursor: pointer;"></i>
                    <div class="account-menu" id="accountMenu">
                        <!-- Guest Menu -->
                        <div id="accountMenuGuest">
                            <div class="account-menu-header">
                                <div class="account-menu-user">Welcome to MyStoreZW</div>
                                <div class="account-menu-email">Sign in to access your account</div>
                            </div>
                            <div class="account-menu-item account-menu-signin" onclick="showAccountModal()">
                                <i class="fas fa-sign-in-alt"></i>
                                <span>Sign In / Register</span>
                            </div>
                        </div>
                        
                        <!-- Logged In Menu -->
                        <div id="accountMenuUser" style="display: none;">
                            <div class="account-menu-header">
                                <div class="account-menu-user" id="accountMenuUserName">User Name</div>
                                <div class="account-menu-email" id="accountMenuUserEmail">user@email.com</div>
                            </div>
<a href="MyStore-Orders.html" class="account-menu-item">
                                <i class="fas fa-store"></i>
                                <span>My Orders</span>
                            </a>

                             <div class="account-menu-item" onclick="showWishlistModal()">
                                <i class="fas fa-heart"></i>
                                <span>Wish List</span>
                            </div>
                            <div class="account-menu-item" onclick="showToast('info', 'Coming Soon', 'Message center coming soon')">
                                <i class="fas fa-envelope"></i>
                                <span>Message Center</span>
                            </div>
                            <div class="account-menu-item" onclick="showToast('info', 'Coming Soon', 'Payment settings coming soon')">
                                <i class="fas fa-credit-card"></i>
                                <span>Payment</span>
                            </div>
                            <div class="account-menu-item" onclick="showToast('info', 'Coming Soon', 'Coupons feature coming soon')">
                                <i class="fas fa-ticket-alt"></i>
                                <span>My Coupons</span>
                            </div>
                            <div class="account-menu-divider"></div>
                            <div class="account-menu-item" onclick="showToast('info', 'Coming Soon', 'Settings page coming soon')">
                                <i class="fas fa-cog"></i>
                                <span>Settings</span>
                            </div>
                            <a href="seller-portal.html" class="account-menu-item">
                                <i class="fas fa-store"></i>
                                <span>Seller Portal</span>
                            </a>
                            <div class="account-menu-divider"></div>
                            <div class="account-menu-item account-menu-logout" onclick="logout()">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Logout</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="cart-icon" onclick="toggleCart()">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-badge" id="cartBadge">0</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Filters Sidebar -->
        <div class="filters-sidebar" id="filtersSidebar">
            <h3>Filters</h3>
            
            <div class="filter-group">
                <h4>Categories</h4>
                <div id="categoryFilters"></div>
            </div>

            <div class="filter-group">
                <h4>Price Range</h4>
                <div id="priceFilters"></div>
            </div>

            <button class="clear-filters" onclick="clearAllFilters()">Clear All Filters</button>
        </div>

        <!-- Products Container -->
        <div class="products-container">
            <div class="products-header">
                <div>
                    <h1 class="products-title" id="pageTitle">All Products</h1>
                    <p class="products-count" id="productsCount">Loading...</p>
                </div>
                <select class="sort-select" id="sortSelect" onchange="applySorting()">
                    <option value="featured">Featured</option>
                    <option value="price-low">Price: Low to High</option>
                    <option value="price-high">Price: High to Low</option>
                    <option value="name">Name: A to Z</option>
                </select>
            </div>

            <div class="products-grid" id="productsGrid"></div>

            <div class="pagination" id="pagination"></div>
        </div>
    </div>

    <!-- Mobile Filter Button -->
    <button class="mobile-filter-btn" onclick="toggleMobileFilters()">
        <i class="fas fa-filter"></i>
    </button>

    <!-- Filter Overlay -->
    <div class="filter-overlay" id="filterOverlay" onclick="toggleMobileFilters()"></div>

    <!-- Product Detail Modal -->
    <div class="modal-overlay" id="productModal">
        <div class="modal-header">
            <button class="modal-back-btn" onclick="closeProductModal()">
                <i class="fas fa-arrow-left"></i>
            </button>
            <h2 id="productModalTitle">Product Details</h2>
        </div>
        <div class="modal-content">
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <!-- Image Lightbox -->
    <div class="image-lightbox" id="imageLightbox" onclick="closeLightbox()">
        <button class="lightbox-close" onclick="closeLightbox()">
            <i class="fas fa-times"></i>
        </button>
        <img src="" alt="Product" class="lightbox-image" id="lightboxImage">
    </div>

    <!-- Cart Sidebar -->
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <h2>Shopping Cart</h2>
            <button class="close-cart" onclick="toggleCart()"><i class="fas fa-times"></i></button>
        </div>
        <div class="cart-items" id="cartItems">
            <div class="empty-cart">
                <i class="fas fa-shopping-cart"></i><br>
                Your cart is empty
            </div>
        </div>
        <div class="cart-footer">
            <div class="cart-total">
                <span>Total:</span>
                <span id="cartTotal">$0.00</span>
            </div>
            <button class="checkout-btn" onclick="showCheckoutModal()">
                Proceed to Checkout
            </button>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div class="modal-overlay" id="checkoutModal">
        <div class="modal-content" style="max-width: 600px;">
            <button class="modal-close" onclick="closeCheckoutModal()">
                <i class="fas fa-times"></i>
            </button>
            <div style="padding: 40px;">
                <h2 style="margin-bottom: 24px;">Checkout</h2>
                <div id="checkoutInfo"></div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Payment Method</label>
                    <select id="paymentMethod" style="width: 100%; padding: 12px; border: 2px solid #e5e5e5; border-radius: 8px; font-size: 14px;">
                        <option value="cash_on_delivery">Cash on Delivery</option>
                        <option value="ecocash">EcoCash</option>
                        <option value="onemoney">OneMoney</option>
                    </select>
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Order Notes (Optional)</label>
                    <textarea id="orderNotes" rows="3" placeholder="Any special instructions..." style="width: 100%; padding: 12px; border: 2px solid #e5e5e5; border-radius: 8px; font-size: 14px; resize: vertical;"></textarea>
                </div>
                <button class="btn btn-large" style="background: #000; color: white;" onclick="placeOrder()">
                    Place Order
                </button>
            </div>
        </div>
    </div>

    <!-- Account Modal -->
    <div class="modal-overlay" id="accountModal">
        <div class="modal-content" style="max-width: 500px;">
            <button class="modal-close" onclick="closeAccountModal()">
                <i class="fas fa-times"></i>
            </button>
            <div style="padding: 40px;">
                <div id="loginForm">
                    <h2 style="margin-bottom: 24px;">Sign In</h2>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Email or Phone</label>
                        <input type="text" id="loginEmail" placeholder="your@email.com or phone" style="width: 100%; padding: 12px; border: 2px solid #e5e5e5; border-radius: 8px; font-size: 14px;">
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Password</label>
                        <input type="password" id="loginPassword" placeholder="" style="width: 100%; padding: 12px; border: 2px solid #e5e5e5; border-radius: 8px; font-size: 14px;">
                    </div>
                    <button class="btn btn-large" style="background: #000; color: white;" onclick="login()">Sign In</button>
                    <div style="text-align: center; margin-top: 16px; font-size: 14px; color: #666;">
                        Don't have an account? <a href="#" onclick="showRegisterForm()" style="color: #000; font-weight: 600; text-decoration: none;">Sign Up</a>
                    </div>
                </div>

                <div id="registerForm" style="display: none;">
                    <h2 style="margin-bottom: 24px;">Create Account</h2>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Full Name</label>
                        <input type="text" id="regName" placeholder="John Doe" style="width: 100%; padding: 12px; border: 2px solid #e5e5e5; border-radius: 8px; font-size: 14px;">
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Email</label>
                        <input type="email" id="regEmail" placeholder="your@email.com" style="width: 100%; padding: 12px; border: 2px solid #e5e5e5; border-radius: 8px; font-size: 14px;">
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Phone</label>
                        <input type="tel" id="regPhone" placeholder="+263771234567" style="width: 100%; padding: 12px; border: 2px solid #e5e5e5; border-radius: 8px; font-size: 14px;">
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Password</label>
                        <input type="password" id="regPassword" placeholder="" style="width: 100%; padding: 12px; border: 2px solid #e5e5e5; border-radius: 8px; font-size: 14px;">
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Delivery Address</label>
                        <textarea id="regAddress" rows="2" placeholder="Street address, building, apartment" style="width: 100%; padding: 12px; border: 2px solid #e5e5e5; border-radius: 8px; font-size: 14px; resize: vertical;"></textarea>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">City</label>
                        <select id="regCity" style="width: 100%; padding: 12px; border: 2px solid #e5e5e5; border-radius: 8px; font-size: 14px;">
                            <option value="">Select your city</option>
                            <option value="Harare">Harare</option>
                            <option value="Bulawayo">Bulawayo</option>
                            <option value="Chitungwiza">Chitungwiza</option>
                            <option value="Mutare">Mutare</option>
                            <option value="Gweru">Gweru</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div id="otherCityGroup" style="display: none; margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Specify City/Town</label>
                        <input type="text" id="regOtherCity" placeholder="Enter your city" style="width: 100%; padding: 12px; border: 2px solid #e5e5e5; border-radius: 8px; font-size: 14px;">
                    </div>
                    <button class="btn btn-large" style="background: #000; color: white;" onclick="register()">Create Account</button>
                    <div style="text-align: center; margin-top: 16px; font-size: 14px; color: #666;">
                        Already have an account? <a href="#" onclick="showLoginForm()" style="color: #000; font-weight: 600; text-decoration: none;">Sign In</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Wishlist Modal -->
    <div class="modal-overlay" id="wishlistModal">
        <div class="modal-content">
            <div class="wishlist-header">
                <button class="wishlist-back-btn" onclick="closeWishlistModal()">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="wishlist-title-section">
                    <div class="wishlist-title">My Wishlist</div>
                    <div class="wishlist-subtitle" id="wishlistSubtitle"></div>
                </div>
                <div class="wishlist-actions-header">
                    <button class="wishlist-header-btn" onclick="clearWishlist()">
                        <i class="fas fa-trash-alt"></i> Clear All
                    </button>
                </div>
            </div>
            <div class="wishlist-body">
                <div id="wishlistItems" class="wishlist-grid"></div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="index.html" class="bottom-nav-item">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </a>
        <a href="#" class="bottom-nav-item active" onclick="document.getElementById('searchInput').focus(); return false;">
            <i class="fas fa-search"></i>
            <span>Search</span>
        </a>
        <a href="#" class="bottom-nav-item" onclick="showWishlistModal(); return false;">
            <i class="fas fa-heart"></i>
            <span>Wishlist</span>
            <span class="bottom-nav-badge" id="wishlistBadge" style="display: none;">0</span>
        </a>
        <a href="#" class="bottom-nav-item" onclick="toggleCart(); return false;">
            <i class="fas fa-shopping-cart"></i>
            <span>Cart</span>
            <span class="bottom-nav-badge" id="bottomCartBadge" style="display: none;">0</span>
        </a>
        <a href="#" class="bottom-nav-item" onclick="toggleMobileAccountMenu(); return false;">
            <i class="fas fa-user"></i>
            <span>Account</span>
        </a>
    </nav>

    <!-- Mobile Account Menu -->
    <div class="mobile-menu-overlay" id="mobileMenuOverlay" onclick="toggleMobileAccountMenu()"></div>
    <div class="mobile-account-menu" id="mobileAccountMenu">
        <div class="mobile-menu-handle"></div>
        
        <!-- Guest Menu -->
        <div id="mobileMenuGuest">
            <div class="mobile-menu-header">
                <div class="mobile-menu-user">Welcome to MyStoreZW</div>
                <div class="mobile-menu-email">Sign in to access your account</div>
            </div>
            <div class="mobile-menu-item mobile-menu-signin" onclick="toggleMobileAccountMenu(); showAccountModal();">
                <i class="fas fa-sign-in-alt"></i>
                <span>Sign In / Register</span>
            </div>
        </div>
        
        <!-- Logged In Menu -->
        <div id="mobileMenuUser" style="display: none;">
            <div class="mobile-menu-header">
                <div class="mobile-menu-user" id="mobileMenuUserName">User Name</div>
                <div class="mobile-menu-email" id="mobileMenuUserEmail">user@email.com</div>
            </div>
           <a href="MyStore-Orders.html" class="mobile-menu-item">
                <i class="fas fa-shopping-bag"></i>
                <span>My Orders</span>
            </a>
                            <div class="mobile-menu-item" onclick="toggleMobileAccountMenu(); showWishlistModal();">
                <i class="fas fa-heart"></i>
                <span>Wish List</span>
            </div>
            <div class="mobile-menu-item" onclick="toggleMobileAccountMenu(); showToast('info', 'Coming Soon', 'Message center coming soon');">
                <i class="fas fa-envelope"></i>
                <span>Message Center Soon!!</span>
            </div>
            <div class="mobile-menu-item" onclick="toggleMobileAccountMenu(); showToast('info', 'Coming Soon', 'Payment settings coming soon');">
                <i class="fas fa-credit-card"></i>
                <span>Payment Soon!!</span>
            </div>
            <div class="mobile-menu-item" onclick="toggleMobileAccountMenu(); showToast('info', 'Coming Soon', 'Coupons feature coming soon');">
                <i class="fas fa-ticket-alt"></i>
                <span>My Coupons Soon!!</span>
            </div>
            <div class="mobile-menu-item" onclick="toggleMobileAccountMenu(); showToast('info', 'Coming Soon', 'Settings page coming soon');">
                <i class="fas fa-cog"></i>
                <span>Settings Soon!!</span>
            </div>
            <a href="seller-portal.html" class="mobile-menu-item">
                <i class="fas fa-store"></i>
                <span>Seller Portal</span>
            </a>
            <div class="mobile-menu-item mobile-menu-logout" onclick="toggleMobileAccountMenu(); logout();">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://tyzuczftbcntvyjmzfev.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR5enVjemZ0YmNudHZ5am16ZmV2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4Njg5NjYsImV4cCI6MjA4MTQ0NDk2Nn0.2UJteZWB4oAj6lltizZy_ztp04L7x9qVQ4s2G5cxMOs';
        const { createClient } = supabase;
        const sb = createClient(SUPABASE_URL, SUPABASE_KEY);

        let allProducts = [];
        let filteredProducts = [];
        let currentCategory = null;
        let currentPriceRange = null;
        let currentSearch = '';
        let currentSort = 'featured';
        let currentPage = 1;
        let productsPerPage = 24;
        let searchTimeout = null;
        let wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
        let currentUser = null;
        let buyerProfile = null;

        const CATEGORY_ICONS = {
            'Electronics': 'fa-laptop',
            'Fashion': 'fa-tshirt',
            'Home': 'fa-home',
            'Beauty': 'fa-spa',
            'Sports': 'fa-football-ball',
            'Automotive': 'fa-car',
            'Jewelry': 'fa-gem',
            'Toys': 'fa-gamepad'
        };

        const PRICE_RANGES = [
            { label: 'Under $50', min: 0, max: 50 },
            { label: '$50 - $100', min: 50, max: 100 },
            { label: '$100 - $200', min: 100, max: 200 },
            { label: 'Over $200', min: 200, max: Infinity }
        ];

        function parseImages(images) {
            if (!images) return [];
            if (Array.isArray(images)) return images;
            if (typeof images === 'string') {
                try {
                    const parsed = JSON.parse(images);
                    return Array.isArray(parsed) ? parsed : [parsed];
                } catch (e) {
                    return [];
                }
            }
            return [];
        }

        function showSkeletonLoading() {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = Array(12).fill(0).map(() => `
                <div class="skeleton-card">
                    <div class="skeleton-image"></div>
                    <div class="skeleton-info">
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line short"></div>
                        <div class="skeleton-line short"></div>
                    </div>
                </div>
            `).join('');
        }

        async function init() {
            updateCartBadge();
            updateWishlistBadge();
            await checkAuth();
            
            const urlParams = new URLSearchParams(window.location.search);
            currentCategory = urlParams.get('category');
            currentSearch = urlParams.get('search') || '';

            if (currentSearch) {
                document.getElementById('searchInput').value = currentSearch;
                document.getElementById('pageTitle').textContent = `Search: "${currentSearch}"`;
            } else if (currentCategory) {
                document.getElementById('pageTitle').textContent = currentCategory;
            }

            showSkeletonLoading();
            await loadProducts();
            loadFilterCounts();
            
            // City selector handler
            const citySelect = document.getElementById('regCity');
            if (citySelect) {
                citySelect.addEventListener('change', function() {
                    const otherGroup = document.getElementById('otherCityGroup');
                    if (this.value === 'Other') {
                        otherGroup.style.display = 'block';
                    } else {
                        otherGroup.style.display = 'none';
                    }
                });
            }
        }

        async function checkAuth() {
            const userId = localStorage.getItem('userId');
            if (userId) {
                try {
                    const { data: user } = await sb.from('users').select('*, buyer:buyer_profiles(*)').eq('id', userId).eq('user_type', 'buyer').single();
                    if (user && user.buyer && user.buyer.length > 0) {
                        currentUser = user;
                        buyerProfile = user.buyer[0];
                        updateAccountMenu();
                    }
                } catch (error) {
                    console.error('Auth check error:', error);
                }
            }
        }

        function updateAccountMenu() {
            if (currentUser) {
                // Desktop menu
                document.getElementById('accountMenuGuest').style.display = 'none';
                document.getElementById('accountMenuUser').style.display = 'block';
                document.getElementById('accountMenuUserName').textContent = currentUser.full_name;
                document.getElementById('accountMenuUserEmail').textContent = currentUser.email;
                
                // Mobile menu
                document.getElementById('mobileMenuGuest').style.display = 'none';
                document.getElementById('mobileMenuUser').style.display = 'block';
                document.getElementById('mobileMenuUserName').textContent = currentUser.full_name;
                document.getElementById('mobileMenuUserEmail').textContent = currentUser.email;
            } else {
                // Desktop menu
                document.getElementById('accountMenuGuest').style.display = 'block';
                document.getElementById('accountMenuUser').style.display = 'none';
                
                // Mobile menu
                document.getElementById('mobileMenuGuest').style.display = 'block';
                document.getElementById('mobileMenuUser').style.display = 'none';
            }
        }

        function toggleMobileAccountMenu() {
            const menu = document.getElementById('mobileAccountMenu');
            const overlay = document.getElementById('mobileMenuOverlay');
            
            if (menu.classList.contains('active')) {
                menu.classList.remove('active');
                overlay.classList.remove('active');
                document.body.style.overflow = '';
            } else {
                menu.classList.add('active');
                overlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        function showAccountModal() {
            if (currentUser) {
                showToast('info', 'Already Signed In', `You're signed in as ${currentUser.full_name}`);
            } else {
                document.getElementById('accountModal').classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeAccountModal() {
            document.getElementById('accountModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        function showLoginForm() {
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
        }

        function showRegisterForm() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
        }

        async function login() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showToast('error', 'Missing Fields', 'Please enter email and password');
                return;
            }

            try {
                const { data: user, error } = await sb.from('users').select('*, buyer:buyer_profiles(*)').or(`email.eq.${email},phone.eq.${email}`).eq('password_hash', password).eq('user_type', 'buyer').single();

                if (error || !user || !user.buyer || user.buyer.length === 0) {
                    showToast('error', 'Login Failed', 'Invalid credentials');
                    return;
                }

                currentUser = user;
                buyerProfile = user.buyer[0];
                localStorage.setItem('userId', user.id);
                localStorage.setItem('userSynced', 'true');
                
                updateAccountMenu();
                closeAccountModal();
                showToast('success', 'Welcome Back!', `Hi ${user.full_name}!`);
            } catch (error) {
                console.error('Login error:', error);
                showToast('error', 'Login Failed', 'Please try again');
            }
        }

        async function register() {
            const name = document.getElementById('regName').value.trim();
            const email = document.getElementById('regEmail').value.trim().toLowerCase();
            const phone = document.getElementById('regPhone').value.trim();
            const password = document.getElementById('regPassword').value;
            const address = document.getElementById('regAddress').value.trim();
            let city = document.getElementById('regCity').value;
            
            if (city === 'Other') {
                const otherCity = document.getElementById('regOtherCity').value.trim();
                if (!otherCity) {
                    showToast('error', 'Missing City', 'Please specify your city');
                    return;
                }
                city = otherCity;
            }

            if (!name || !email || !phone || !password || !address || !city) {
                showToast('error', 'Missing Fields', 'Please fill all required fields');
                return;
            }

            if (password.length < 6) {
                showToast('error', 'Weak Password', 'Password must be at least 6 characters');
                return;
            }

            try {
                const { data: existingUser } = await sb
                    .from('users')
                    .select('id')
                    .eq('email', email)
                    .single();

                if (existingUser) {
                    showToast('error', 'Email Taken', 'This email is already registered');
                    return;
                }

                const { data: user, error: userError } = await sb.from('users').insert({
                    email, phone, full_name: name, password_hash: password, user_type: 'buyer'
                }).select().single();

                if (userError) throw userError;

                const { data: buyer, error: buyerError } = await sb.from('buyer_profiles').insert({
                    user_id: user.id, delivery_address: address, city: city
                }).select().single();

                if (buyerError) throw buyerError;

                currentUser = user;
                buyerProfile = buyer;
                localStorage.setItem('userId', user.id);
                localStorage.setItem('userSynced', 'true');
                
                updateAccountMenu();
                closeAccountModal();
                showToast('success', 'Account Created!', 'Welcome to MyStoreZW');
            } catch (error) {
                console.error('Registration error:', error);
                showToast('error', 'Registration Failed', 'Please try again');
            }
        }

        function logout() {
            currentUser = null;
            buyerProfile = null;
            localStorage.removeItem('userId');
            localStorage.removeItem('userSynced');
            updateAccountMenu();
            showToast('success', 'Logged Out', 'See you soon!');
        }

        async function loadProducts() {
            try {
                const { data: products, error } = await sb
                    .from('products')
                    .select('*, seller:seller_profiles(business_name), category:categories(name)')
                    .eq('is_active', true)
                    .gt('stock_quantity', 0);
                
                if (error) throw error;
                
                allProducts = products || [];
                applyFilters();
            } catch (error) {
                console.error('Error loading products:', error);
                showErrorMessage(error);
            }
        }

        function showErrorMessage(error) {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = `
                <div class="error-message">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>Oops! Something went wrong</h3>
                    <p>We couldn't load the products. Please check your internet connection and try again.</p>
                    <p style="font-size: 12px; color: #999; margin-top: 8px;">Error: ${error.message}</p>
                    <button class="retry-btn" onclick="init()">
                        <i class="fas fa-redo"></i> Retry
                    </button>
                </div>
            `;
        }

        function loadFilterCounts() {
            // Category counts
            const categoryCounts = {};
            allProducts.forEach(p => {
                const catName = p.category?.name || 'Other';
                categoryCounts[catName] = (categoryCounts[catName] || 0) + 1;
            });

            const categoryContainer = document.getElementById('categoryFilters');
            categoryContainer.innerHTML = Object.keys(CATEGORY_ICONS).map(cat => {
                const icon = CATEGORY_ICONS[cat];
                const count = categoryCounts[cat] || 0;
                const isActive = currentCategory === cat ? 'active' : '';
                return `
                <div class="filter-option ${isActive}" onclick="applyCategoryFilter('${cat}')">
                    <div class="filter-label">
                        <i class="fas ${icon}"></i>
                        <span>${cat}</span>
                    </div>
                    <span class="filter-count">${count}</span>
                </div>
            `}).join('');

            // Price range counts
            const priceContainer = document.getElementById('priceFilters');
            priceContainer.innerHTML = PRICE_RANGES.map((range, index) => {
                const count = allProducts.filter(p => {
                    const price = parseFloat(p.price);
                    return price >= range.min && price < range.max;
                }).length;
                
                const rangeKey = `${range.min}-${range.max === Infinity ? '' : range.max}`;
                const isActive = currentPriceRange === rangeKey ? 'active' : '';
                
                return `
                <div class="filter-option ${isActive}" onclick="applyPriceFilter('${rangeKey}')">
                    <div class="filter-label">
                        <i class="fas fa-dollar-sign"></i>
                        <span>${range.label}</span>
                    </div>
                    <span class="filter-count">${count}</span>
                </div>
            `}).join('');
        }

        function applyFilters() {
            filteredProducts = allProducts.filter(p => {
                // Category filter
                if (currentCategory) {
                    const catName = p.category?.name || '';
                    if (catName !== currentCategory) return false;
                }

                // Search filter
                if (currentSearch) {
                    const searchLower = currentSearch.toLowerCase();
                    const matchSearch = p.name.toLowerCase().includes(searchLower) ||
                                       (p.description && p.description.toLowerCase().includes(searchLower));
                    if (!matchSearch) return false;
                }

                // Price filter
                if (currentPriceRange) {
                    const [min, max] = currentPriceRange.split('-').map(v => parseFloat(v) || Infinity);
                    const price = parseFloat(p.price);
                    if (price < min || (max !== Infinity && price >= max)) return false;
                }

                return true;
            });

            currentPage = 1;
            applySorting();
        }

        function applySorting() {
            const sortValue = document.getElementById('sortSelect').value;
            currentSort = sortValue;

            const sorted = [...filteredProducts];
            
            switch(sortValue) {
                case 'price-low':
                    sorted.sort((a, b) => parseFloat(a.price) - parseFloat(b.price));
                    break;
                case 'price-high':
                    sorted.sort((a, b) => parseFloat(b.price) - parseFloat(a.price));
                    break;
                case 'name':
                    sorted.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                default:
                    break;
            }

            displayProducts(sorted);
        }

        function displayProducts(products) {
            const grid = document.getElementById('productsGrid');
            document.getElementById('productsCount').textContent = `${products.length} products found`;

            if (products.length === 0) {
                grid.innerHTML = '<div class="no-products"><i class="fas fa-box-open"></i><br><h3>No products found</h3><p>Try adjusting your filters or search terms</p></div>';
                document.getElementById('pagination').innerHTML = '';
                return;
            }

            // Pagination
            const totalPages = Math.ceil(products.length / productsPerPage);
            const startIndex = (currentPage - 1) * productsPerPage;
            const endIndex = startIndex + productsPerPage;
            const paginatedProducts = products.slice(startIndex, endIndex);

            grid.innerHTML = paginatedProducts.map(p => {
                const images = parseImages(p.images);
                const firstImage = images[0];
                const hasDiscount = p.compare_at_price && parseFloat(p.compare_at_price) > parseFloat(p.price);
                const discountPercent = hasDiscount ? Math.round(((parseFloat(p.compare_at_price) - parseFloat(p.price)) / parseFloat(p.compare_at_price)) * 100) : 0;
                const isWishlisted = wishlist.includes(p.id);
                
                return `
                <div class="product-card" onclick='openProductModal(${JSON.stringify(p).replace(/'/g, "&apos;")})'>
                    <div class="product-image">
                        ${firstImage ? `<img src="${firstImage}" alt="${p.name}" loading="lazy">` : '<i class="fas fa-box" style="font-size: 60px; color: #ddd;"></i>'}
                        ${hasDiscount ? `<div class="product-discount">-${discountPercent}%</div>` : ''}
 

                        <button class="wishlist-btn ${isWishlisted ? 'active' : ''}" onclick="event.stopPropagation(); toggleWishlist('${p.id}')">
                            <i class="fas fa-heart"></i>
                        </button>
                    </div>
                    <div class="product-info">
                        <div class="product-name">${p.name}</div>
                        <div class="product-price">
                            ${parseFloat(p.price).toFixed(2)}
                            ${hasDiscount ? `<span class="original-price">${parseFloat(p.compare_at_price).toFixed(2)}</span>` : ''}
                        </div>
                        <div class="product-seller">${p.seller?.business_name || 'Seller'}</div>
${p.condition ? `
  <div class="product-seller" style="
    color: ${p.condition === 'New' ? '#10b981' : p.condition === 'Used' ? '#f59e0b' : '#666'};
    font-size: 12px;
    margin-top: -8px;
  ">
    ${p.condition}
  </div>
` : ''}

  
                        <button class="btn" onclick='event.stopPropagation(); addToCart(${JSON.stringify(p).replace(/'/g, "&apos;")})'>
                            <i class="fas fa-cart-plus"></i> Add to Cart
                        </button>
                    </div>
                </div>
            `}).join('');

            displayPagination(totalPages);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function displayPagination(totalPages) {
            const container = document.getElementById('pagination');
            
            if (totalPages <= 1) {
                container.innerHTML = '';
                return;
            }

            let paginationHTML = `
                <button class="pagination-btn" onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
                    <i class="fas fa-chevron-left"></i>
                </button>
            `;

            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
                    paginationHTML += `
                        <button class="pagination-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">
                            ${i}
                        </button>
                    `;
                } else if (i === currentPage - 2 || i === currentPage + 2) {
                    paginationHTML += `<span>...</span>`;
                }
            }

            paginationHTML += `
                <button class="pagination-btn" onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
                    <i class="fas fa-chevron-right"></i>
                </button>
            `;

            container.innerHTML = paginationHTML;
        }

        function changePage(page) {
            currentPage = page;
            applySorting();
        }

        function applyCategoryFilter(category) {
            currentCategory = currentCategory === category ? null : category;
            
            const options = document.querySelectorAll('#categoryFilters .filter-option');
            options.forEach(opt => opt.classList.remove('active'));
            
            if (currentCategory) {
                event.target.closest('.filter-option').classList.add('active');
                document.getElementById('pageTitle').textContent = currentCategory;
            } else {
                document.getElementById('pageTitle').textContent = 'All Products';
            }
            
            applyFilters();
        }

        function applyPriceFilter(range) {
            currentPriceRange = currentPriceRange === range ? null : range;
            
            const options = document.querySelectorAll('#priceFilters .filter-option');
            options.forEach(opt => opt.classList.remove('active'));
            
            if (currentPriceRange) {
                event.target.closest('.filter-option').classList.add('active');
            }
            
            applyFilters();
        }

        function applySearch() {
            currentSearch = document.getElementById('searchInput').value.trim();
            if (currentSearch) {
                document.getElementById('pageTitle').textContent = `Search: "${currentSearch}"`;
            } else {
                document.getElementById('pageTitle').textContent = 'All Products';
            }
            applyFilters();
        }

        // Debounced search
        document.getElementById('searchInput').addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                applySearch();
            }, 500);
        });

        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                clearTimeout(searchTimeout);
                applySearch();
            }
        });

        function clearAllFilters() {
            currentCategory = null;
            currentPriceRange = null;
            currentSearch = '';
            document.getElementById('searchInput').value = '';
            document.getElementById('pageTitle').textContent = 'All Products';
            
            document.querySelectorAll('.filter-option').forEach(opt => opt.classList.remove('active'));
            applyFilters();
        }

        function toggleWishlist(productId) {
            if (wishlist.includes(productId)) {
                wishlist = wishlist.filter(id => id !== productId);
            } else {
                wishlist.push(productId);
            }
            localStorage.setItem('wishlist', JSON.stringify(wishlist));
            updateWishlistBadge();
            applySorting(); // Refresh display
        }

        function updateWishlistBadge() {
            const badge = document.getElementById('wishlistBadge');
            if (wishlist.length > 0) {
                badge.textContent = wishlist.length;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }

        function showWishlistModal() {
            const modal = document.getElementById('wishlistModal');
            const container = document.getElementById('wishlistItems');
            
            if (wishlist.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 60px 20px; color: #999; grid-column: 1/-1;"><i class="fas fa-heart" style="font-size: 60px; margin-bottom: 16px; opacity: 0.3;"></i><br><h3>Your wishlist is empty</h3><p>Add products you love to your wishlist</p></div>';
            } else {
                const wishlistProducts = allProducts.filter(p => wishlist.includes(p.id));
                container.innerHTML = wishlistProducts.map(p => {
                    const images = parseImages(p.images);
                    const firstImage = images[0];
                    
                    return `
                    <div class="product-card" onclick='openProductModal(${JSON.stringify(p).replace(/'/g, "&apos;")})'>
                        <div class="product-image">
                            ${firstImage ? `<img src="${firstImage}" alt="${p.name}" loading="lazy">` : '<i class="fas fa-box" style="font-size: 60px; color: #ddd;"></i>'}
                            <button class="wishlist-btn active" onclick="event.stopPropagation(); toggleWishlist('${p.id}'); showWishlistModal();">
                                <i class="fas fa-heart"></i>
                            </button>
                        </div>
                        <div class="product-info">
                            <div class="product-name">${p.name}</div>
                            <div class="product-price">${parseFloat(p.price).toFixed(2)}</div>
                            <button class="btn" onclick='event.stopPropagation(); addToCart(${JSON.stringify(p).replace(/'/g, "&apos;")})'>
                                <i class="fas fa-cart-plus"></i> Add to Cart
                            </button>
                        </div>
                    </div>
                `}).join('');
            }
            
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeWishlistModal() {
            document.getElementById('wishlistModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        function showCheckoutModal() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            
            if (cart.length === 0) {
                alert('Your cart is empty');
                return;
            }

            if (!currentUser || !buyerProfile) {
                alert('Please sign in to checkout');
                toggleCart();
                showAccountModal();
                return;
            }

            const info = `
                <div style="background: #f5f5f5; padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                    <p style="margin-bottom: 8px;"><strong>Name:</strong> ${currentUser.full_name}</p>
                    <p style="margin-bottom: 8px;"><strong>Phone:</strong> ${currentUser.phone}</p>
                    <p style="margin-bottom: 8px;"><strong>Address:</strong> ${buyerProfile.delivery_address}</p>
                    <p><strong>City:</strong> ${buyerProfile.city}</p>
                </div>
            `;
            document.getElementById('checkoutInfo').innerHTML = info;
            document.getElementById('checkoutModal').classList.add('active');
            document.body.style.overflow = 'hidden';
            toggleCart();
        }

        function closeCheckoutModal() {
            document.getElementById('checkoutModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        async function placeOrder() {
            if (!buyerProfile) {
                alert('Please sign in first');
                return;
            }

            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            if (cart.length === 0) {
                alert('Your cart is empty');
                return;
            }

            const paymentMethod = document.getElementById('paymentMethod').value;
            const notes = document.getElementById('orderNotes').value.trim();

            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            btn.disabled = true;

            try {
                const ordersBySeller = {};
                cart.forEach(item => {
                    if (!ordersBySeller[item.seller_id]) {
                        ordersBySeller[item.seller_id] = [];
                    }
                    ordersBySeller[item.seller_id].push(item);
                });

                let orderCount = 0;

                for (const sellerId in ordersBySeller) {
                    const items = ordersBySeller[sellerId];
                    const subtotal = items.reduce((sum, item) => sum + (parseFloat(item.price) * parseInt(item.quantity)), 0);
                    
                    const { data: seller } = await sb.from('seller_profiles').select('commission_rate').eq('id', sellerId).single();
                    const rate = seller?.commission_rate || 15;
                    const commission = subtotal * (rate / 100);
                    const sellerAmount = subtotal - commission;

                    const orderNum = 'ORD-' + Date.now() + '-' + Math.random().toString(36).substr(2, 6).toUpperCase();

                    const { data: order, error } = await sb.from('orders').insert({
                        order_number: orderNum,
                        buyer_id: buyerProfile.id,
                        seller_id: sellerId,
                        subtotal: subtotal,
                        commission_amount: commission,
                        seller_amount: sellerAmount,
                        total_amount: subtotal,
                        delivery_address: buyerProfile.delivery_address,
                        delivery_city: buyerProfile.city,
                        delivery_phone: currentUser.phone,
                        delivery_notes: notes,
                        payment_method: paymentMethod,
                        status: 'pending'
                    }).select().single();

                    if (error) throw error;

                    for (const item of items) {
                        await sb.from('order_items').insert({
                            order_id: order.id,
                            product_id: item.id,
                            product_name: item.name,
                            product_price: parseFloat(item.price),
                            quantity: parseInt(item.quantity),
                            subtotal: parseFloat(item.price) * parseInt(item.quantity)
                        });

                        const { data: currentProduct } = await sb
                            .from('products')
                            .select('stock_quantity')
                            .eq('id', item.id)
                            .single();
                        
                        if (currentProduct) {
                            const newStock = Math.max(0, currentProduct.stock_quantity - item.quantity);
                            await sb.from('products')
                                .update({ stock_quantity: newStock })
                                .eq('id', item.id);
                        }
                    }

                    await sb.from('commission_transactions').insert({
                        order_id: order.id,
                        seller_id: sellerId,
                        order_total: subtotal,
                        commission_rate: rate,
                        commission_amount: commission,
                        seller_amount: sellerAmount,
                        status: 'pending'
                    });

                    orderCount++;
                }

                alert(`Order placed successfully! ${orderCount} order(s) created.`);
                localStorage.setItem('cart', JSON.stringify([]));
                updateCartBadge();
                updateCartDisplay();
                closeCheckoutModal();
                await loadProducts();
                
            } catch (error) {
                console.error('Order error:', error);
                alert('Order failed. Please try again.');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        function openProductModal(product) {
            const images = parseImages(product.images);
            const hasImages = images.length > 0;
            const hasDiscount = product.compare_at_price && parseFloat(product.compare_at_price) > parseFloat(product.price);

            let galleryHTML = '';
            if (hasImages) {
                galleryHTML = `
                    <div class="modal-gallery">
                        <img src="${images[0]}" alt="${product.name}" class="main-image" id="mainModalImage">
                        ${images.length > 1 ? `
                            <div class="thumbnail-grid">
                                ${images.map((img, index) => `
                                    <img src="${img}" 
                                         alt="${product.name} ${index + 1}" 
                                         class="thumbnail ${index === 0 ? 'active' : ''}"
                                         onclick="changeMainImage('${img}', event)">
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
            } else {
                galleryHTML = `
                    <div class="modal-gallery">
                        <div style="width: 100%; height: 500px; background: #fafafa; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 80px; color: #ddd;">
                            <i class="fas fa-box"></i>
                        </div>
                    </div>
                `;
            }

            const modalBody = document.getElementById('modalBody');
            modalBody.innerHTML = `
                ${galleryHTML}
                <div class="modal-info">
                    <h2>${product.name}</h2>
                    <div class="modal-price">
                        ${parseFloat(product.price).toFixed(2)}
                        ${hasDiscount ? `<span class="original-price">${parseFloat(product.compare_at_price).toFixed(2)}</span>` : ''}
                    </div>
                    ${product.description ? `
                        <div class="modal-description">${product.description}</div>
                    ` : ''}
                    <div class="modal-meta">
                        <p><strong>Seller:</strong> ${product.seller?.business_name || 'Seller'}</p>
                        <p><strong>Category:</strong> ${product.category?.name || 'General'}</p>
                        <p><strong>Stock:</strong> ${product.stock_quantity} available</p>
${product.condition ? `
  <p><strong>Condition:</strong> 
    <span style="
      background: ${product.condition === 'New' ? '#d1fae5' : product.condition === 'Used' ? '#fef3c7' : '#e0e7ff'};
      color: ${product.condition === 'New' ? '#065f46' : product.condition === 'Used' ? '#92400e' : '#3730a3'};
      padding: 4px 10px;
      border-radius: 6px;
      font-weight: 600;
      font-size: 13px;
    ">${product.condition}</span>
  </p>
` : ''}
                    </div>
                    <div class="modal-actions">
                        <button class="btn btn-large" onclick='addToCart(${JSON.stringify(product).replace(/'/g, "&apos;")}); closeProductModal();'>
                            <i class="fas fa-cart-plus"></i> Add to Cart
                        </button>
                        <button class="btn btn-large" onclick="toggleWishlist('${product.id}')">
                            <i class="fas fa-heart"></i> Wishlist
                        </button>
                    </div>
                </div>
            `;

            document.getElementById('productModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function changeMainImage(src, event) {
            document.getElementById('mainModalImage').src = src;
            document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
        }

        function closeProductModal() {
            document.getElementById('productModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        function toggleMobileFilters() {
            document.getElementById('filtersSidebar').classList.toggle('mobile-active');
            document.getElementById('filterOverlay').classList.toggle('active');
        }

        function addToCart(product) {
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            const productToStore = {
                ...product,
                images: parseImages(product.images)
            };
            
            const existing = cart.find(item => item.id === product.id);
            if (existing) {
                if (existing.quantity >= product.stock_quantity) {
                    alert(`Only ${product.stock_quantity} available in stock`);
                    return;
                }
                existing.quantity++;
            } else {
                cart.push({ ...productToStore, quantity: 1 });
            }
            
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartBadge();
            updateCartDisplay();
            
            // Show mini notification
            const notification = document.createElement('div');
            notification.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #10b981; color: white; padding: 16px 24px; border-radius: 8px; z-index: 9999; animation: slideInRight 0.3s;';
            notification.innerHTML = '<i class="fas fa-check-circle"></i> Added to cart!';
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 2000);
        }

        function toggleCart() {
            document.getElementById('cartSidebar').classList.toggle('active');
            updateCartDisplay();
        }

        function updateCartDisplay() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const container = document.getElementById('cartItems');
            
            if (cart.length === 0) {
                container.innerHTML = '<div class="empty-cart"><i class="fas fa-shopping-cart"></i><br>Your cart is empty</div>';
                document.getElementById('cartTotal').textContent = '$0.00';
                return;
            }

            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            document.getElementById('cartTotal').textContent = `${total.toFixed(2)}`;

            container.innerHTML = cart.map(item => {
                const images = parseImages(item.images);
                const firstImage = images[0];
                
                return `
                <div class="cart-item">
                    <div class="cart-item-image">
                        ${firstImage ? `<img src="${firstImage}" alt="${item.name}">` : '<i class="fas fa-box"></i>'}
                    </div>
                    <div class="cart-item-info">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">${parseFloat(item.price).toFixed(2)}</div>
                        <div class="cart-item-qty">
                            <button class="qty-btn" onclick="updateQuantity('${item.id}', -1)">-</button>
                            <span>${item.quantity}</span>
                            <button class="qty-btn" onclick="updateQuantity('${item.id}', 1)">+</button>
                            <button class="qty-btn" onclick="removeFromCart('${item.id}')" style="margin-left: auto; color: red;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `}).join('');
        }

        function updateQuantity(productId, change) {
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            const item = cart.find(item => item.id === productId);
            
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    cart = cart.filter(item => item.id !== productId);
                }
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartBadge();
                updateCartDisplay();
            }
        }

        function removeFromCart(productId) {
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            cart = cart.filter(item => item.id !== productId);
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartBadge();
            updateCartDisplay();
        }

        function updateCartBadge() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const total = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cartBadge').textContent = total;
            document.getElementById('bottomCartBadge').textContent = total;
            
            if (total === 0) {
                document.getElementById('bottomCartBadge').style.display = 'none';
            } else {
                document.getElementById('bottomCartBadge').style.display = 'flex';
            }
        }

        // Close modals on overlay click
        document.addEventListener('click', function(e) {
            if (e.target.id === 'checkoutModal' || e.target.id === 'accountModal' || e.target.id === 'wishlistModal') {
                closeCheckoutModal();
                closeAccountModal();
                closeWishlistModal();
            }
        });

        // Swipe gestures for mobile
        let touchStartX = 0;
        let touchEndX = 0;

        document.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
        });

        document.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });

        function handleSwipe() {
            const swipeThreshold = 100;
            const diff = touchEndX - touchStartX;
            
            if (Math.abs(diff) > swipeThreshold) {
                const cartSidebar = document.getElementById('cartSidebar');
                if (diff > 0 && cartSidebar.classList.contains('active')) {
                    // Swipe right - close cart
                    toggleCart();
                }
            }
        }

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>